<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0' name='viewport'>
<meta property="og:title" content="RRP6 FINANCIAL TRACKING -JORDAN - 2014"/>
<meta property="og:type" content="article"/>
<meta property="og:site_name" content="RRP6 FINANCIAL TRACKING -JORDAN - 2014"/>
<meta property="og:description" content="RRP6 FINANCIAL TRACKING -JORDAN - 2014"/>
    <title>RRP6 FINANCIAL TRACKING -JORDAN - 2014 </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">

    <link rel="stylesheet" href="css/bootswatch.min.css">
    <link rel="stylesheet" href="css/font-humanitarian.css">

    <link rel="stylesheet" type="text/css" href="css/dc.css"/>

    <link rel="stylesheet" type="text/css" href="css/dashboard.css"/>
    <!---->
    <!-- Add IntroJs styles and JS -->
    <link rel="stylesheet" type="text/css" href="css/introjs.min.css" >
    <script type="text/javascript" src="js/intro.min.js"></script>
    <script src="js/jquery.js"></script>
    <!-- map the data to the GeoJSON object -->
    <script src="js/data-jo.js"></script>
    <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">
    <!-- hide and display Disclaimer -->
    <script>
        function show(shown, hidden) {
          document.getElementById(shown).style.display='block';
          document.getElementById(hidden).style.display='none';
          return false;
        }
    </script>
  </head>

  <body>
    <div class ="col-sm-4 col-md-offset4" id="loading">
        <small>This webpage does not work on IE8 or older... Upgrade your browser if needed</a></a></small>
    </div>
    <div class="container" id="dashboard">
	
        <div class="socialmedia" data-step="13" data-intro="Share!!" data-position="left">
            <table>
              <tbody><tr>
                <td valign="middle"><a href="index.html" target="_blank">Financial Tracking 2015</a></td>
            </tr>
            </tbody></table>
        </div>
        <div class="row" >
            <h1>
               <a href="http://data.unhcr.org/jordan"><img src="images/coordination.png" style="height: 48px; width: 48px"></a>
               <strong>RRP6 FINANCIAL TRACKING -JORDAN - 2014</strong>
            </h1>
 The below includes information reported by partners at the Jordan level. Regional and other un-earmarked contributions, not yet reflected here, may also benefit the RRP6 in Jordan.<br>
            <h2>
            <a class="btn btn-default">Total Requested (USD) <a  class="btn btn-primary">$ <span id="totalrequired" class="number-display"></span></a></a>
            <a class="btn btn-default">Funds Received (USD) <a  class="btn btn-info">$ <span id="totalreceived" class="number-display"></span></a></a>
            <a class="btn btn-default">Not yet funded (USD) <a  class="btn btn-warning">$ <span id="totalgap" class="number-display"></span></a></a>
           <!--
           <a class="btn btn-default">Gap <a  class="btn btn-danger">% <span id="totalpercentage" class="number-display"></span></a></a>
           -->
            </h2>
            <br>
            <div id="count-info" >
                 You have selected <strong><span class="filter-count "></span> reports</strong> out of a total of <span class="total-count "></span> reports
                 <a class="btn btn-primary btn-sm" href="javascript:dc.filterAll();quarter_chart.filter('0- Yearly');dc.redrawAll();">Click to reset all filters</a>
            </div>

       </div>
       <div class="row">
            <div class="col-md-6">
              <div class="row">

                <div class="col-xs-6" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>

                <div id="quarter"> <center> <h4>Quarters</h4> </center></div>
                </div>
                <div id="sector" class="col-xs-6" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>
                  <center> <h4>Received funds across Sectors</h4> </center>
                </div>
              </div>
              <div class="row">
                <div id="gapReceived" class="col-xs-12" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>
                  <center> <h4>Distribution of received funds/gap across Sectors</h4> </center>
                </div>
              </div>

              <div class="row">
                <center>
                   <table width=100% cellspacing=1 cellpadding=1>
                        <tr>
                            <td width=110px>&nbsp;</td>
                            <td></td>
                            <td><img src="images/cash.svg" alt="Cash" height="30px" width="30px"></td>
                            <td><img src="images/education.svg" alt="Education" height="30px" width="30px"></td>
                            <td><img src="images/foodsecurity.svg" alt="Food Security" height="30px" width="30px"></td>
                            <td><img src="images/health.svg" alt="Health" height="30px" width="30px"></td>
                            <td><img src="images/nfi.svg" alt="Health" height="30px" width="30px"></td>							
                            <td><img src="images/protection.svg" alt="Protection" height="30px" width="30px"></td>
                            <td><img src="images/shelter.svg" alt="Shelter" height="30px" width="30px"></td>
                            <td><img src="images/wash.svg" alt="WASH" height="30px" width="30px"></td>
                            <td></td>
                        </tr>
                    </table>
                </center> 
                <br>
              </div>

            </div>
            <div class="col-md-6">
              <div class="row">
                <div id="partner" class="col-xs-6" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>
                  <center> <h4>Received funds per Agency</h4> </center>
                </div>
                <div id="partnergap" class="col-xs-6" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>
                  <center> <h4>Funding gap per Agency</h4> </center>
                </div>
              </div>
            </div>
       </div>
    </div>
        <div class="row">

            <div class="col-md-12" data-step="11" data-intro="Click on this row chart to filter by partner." data-position="right">
                <h5><strong>Filter by Partners</strong><small> </small></h5>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ACF"); dc.renderAll();' ><img src="images/partner/acf.jpg" alt="Filter on ACF" /></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ACTED"); dc.renderAll();' ><img src="images/partner/acted.jpg" alt="ACTED" /></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ActionAid"); dc.renderAll();'><img src="images/partner/actionaid.jpg" alt="Filter on Agency for Technical Cooperation and Development"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ADRA"); dc.renderAll();'><img src="images/partner/adra.jpg" alt="Filter on Adventist Development and Relief Agency"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("AVSI"); dc.renderAll();'><img src="images/partner/avsi.jpg" alt="Filter on Association of Volunteers in International Service"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("CARE"); dc.renderAll();'><img src="images/partner/care.jpg" alt="Filter on CARE"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("CARITAS"); dc.renderAll();'><img src="images/partner/caritas.jpg" alt="Filter on CARITAS"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("CHF"); dc.renderAll();'><img src="images/partner/chf.jpg" alt="Filter on Common Humanitarian aid"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("CVT"); dc.renderAll();'><img src="images/partner/cvt.jpg" alt="Filter on Center for Victims of Torture"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("DRC"); dc.renderAll();'><img src="images/partner/drc.jpg" alt="Filter on Danish Refugee Council"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("FPSC"); dc.renderAll();'><img src="images/partner/fpsci.jpg" alt="Filter on Foundation Promotion Social de la Cultura"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("HI"); dc.renderAll();'><img src="images/partner/hi.jpg" alt="Filter on Handicap International"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ILO"); dc.renderAll();'><img src="images/partner/ilo.jpg" alt="Filter on International Labor Organisation"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IMC"); dc.renderAll();'><img src="images/partner/imc.jpg" alt="Filter on International Medical Corps"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("ICMC"); dc.renderAll();'><img src="images/partner/icmc.jpg" alt="Filter on International Catholic Migration Commission"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("INTERSOS"); dc.renderAll();'><img src="images/partner/intersos.jpg" alt="Filter on Intersos"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IOCC"); dc.renderAll();'><img src="images/partner/iocc.jpg" alt="Filter on International Orthodox Christian Charities"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IOM"); dc.renderAll();'><img src="images/partner/iom.jpg" alt="Filter on International Organisation of Migration"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IRW"); dc.renderAll();'><img src="images/partner/irw.jpg" alt="Filter on Islamic Relief Worldwide"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IRC"); dc.renderAll();'><img src="images/partner/irc.jpg" alt="Filter on International Rescue Committee"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("IRD"); dc.renderAll();'><img src="images/partner/ird.jpg" alt="Filter on International Relief Development"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("JEN"); dc.renderAll();'><img src="images/partner/jen.jpg" alt="Filter on Japan Emergency NGOs"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("JHAS"); dc.renderAll();'><img src="images/partner/jhas.jpg" alt="Filter on Jordan Health Aid Society"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("JHCO"); dc.renderAll();'><img src="images/partner/jhco.jpg" alt="Filter on Jordan Hashemite charity organization"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("KNK"); dc.renderAll();'><img src="images/partner/knk.jpg" alt="Filter on ACTED"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("LWF"); dc.renderAll();'><img src="images/partner/lwf.jpg" alt="Filter on ACTED"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("FAO"); dc.renderAll();'><img src="images/partner/fao.jpg" alt="Filter on FAO"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("LA"); dc.renderAll();'><img src="images/partner/la.jpg" alt="Filter on Legal Aid"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("MSF-F"); dc.renderAll();'><img src="images/partner/msf.jpg" alt="Filter on Médecins Sans Frontiere"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("MercyCorps"); dc.renderAll();'><img src="images/partner/mc.jpg" alt="Filter on MercyCorps"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("MDM"); dc.renderAll();'><img src="images/partner/mdm.jpg" alt="Filter on Médecins du Monde"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("MEDAIR"); dc.renderAll();'><img src="images/partner/medair.jpg" alt="Filter on MEDAIR International Humanitarian Aid Organisation"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("POLA"); dc.renderAll();'><img src="images/partner/movimiento-po-la-paz.jpg" alt="Filter on ACTED"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("NICCOD"); dc.renderAll();'><img src="images/partner/niccod.jpg" alt="Filter on Nippon International Cooperation for Community Development"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("NRC"); dc.renderAll();'><img src="images/partner/nrc.jpg" alt="Filter on Norweigan Refugee Council"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("OPM"); dc.renderAll();'><img src="images/partner/operation-mercy.jpg" alt="Filter on Operation Mercy"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("OXFAM"); dc.renderAll();'><img src="images/partner/oxfam.jpg" alt="Filter on OXFAM"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("PU-AMI"); dc.renderAll();'><img src="images/partner/pu-ami.jpg" alt="Filter on Première Urgence - Aide Médicale Internationale"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("Questscope"); dc.renderAll();'><img src="images/partner/quetscope.jpg" alt="Filter on Questcope"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("SCI"); dc.renderAll();'><img src="images/partner/sci.jpg" alt="Filter on Save the 
                Children International"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("SCJordan"); dc.renderAll();'><img 
                src="images/partner/scjordan.jpg" alt="Filter on Save the 
                Children Jordan"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("RI"); dc.renderAll();'><img src="images/partner/ri.jpg" alt="Filter on Relief International"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("Taghyeer"); dc.renderAll();'><img src="images/partner/taghyeer.jpg" alt="Filter on Taghyeer - welovereading"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("TDH"); dc.renderAll();'><img src="images/partner/tdh.jpg" alt="Filter on Terre Des Hommes"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("TDHI"); dc.renderAll();'><img src="images/partner/tdh-it.jpg" alt="Filter on Terre des Hommes Italia"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("THW"); dc.renderAll();'><img src="images/partner/thw.jpg" alt="Filter on Federal Agency for Technical Relief"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("TGH"); dc.renderAll();'><img src="images/partner/triangle.jpg" alt="Filter on Triangle Génération Humanitaire"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNDP"); dc.renderAll();'><img src="images/partner/undp.jpg" alt="Filter on UNDP"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNESCO"); dc.renderAll();'><img src="images/partner/unesco.jpg" alt="Filter on United Nations Educational, Scientific and Cultural Organisation"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNFPA"); dc.renderAll();'><img src="images/partner/unfpa.jpg" alt="Filter on United Nations Population Fund"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNHABITAT"); dc.renderAll();'><img src="images/partner/unhabitat.jpg" alt="Filter on United Nations HABITAT"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNHCR"); dc.renderAll();'><img src="images/partner/unhcr.jpg" alt="Filter on UN High Commissioner for Refugees"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNICEF"); dc.renderAll();'><img src="images/partner/unicef.jpg" alt="Filter on United Nations Children's Funds"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UNOPS"); dc.renderAll();'><img src="images/partner/unops.jpg" alt="Filter on United Nations Office for Project Services"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("UPP"); dc.renderAll();'><img 
                src="images/partner/upp.jpg" alt="Filter on Un Ponte 
                per"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("WARCHILD"); dc.renderAll();'><img src="images/partner/warchild.jpg" alt="Filter on WarChild UK"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("WFP"); dc.renderAll();'><img src="images/partner/wfp.jpg" alt="Filter on World Food Programme"/></a>
                <a href='javascript:dc.filterAll(); partner_chart.filter("WVI"); dc.renderAll();'><img src="images/partner/wvi.jpg" alt="Filter on World Vision International"/></a>
                
            </div>
        </div>	

    <div width="100%" style="background:#006CA9; height:25px" align=right>
        <span  class="demoTableRow"><font color="#FFFFFF">
            Produced by Information Management Unit, UNHCR, Jordan. For more information please contact <a href="http://data.unhcr.org/jordan/team.html" target="_blank" >our team</a> </font>
         </span> &nbsp;&nbsp;&nbsp;
    </div>

    <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/d3.tip.min.js"></script>
    <script type="text/javascript" src="js/d3num.js"></script>	
    <script>

        $('#dashboard').hide();
      //  var gap_chart = dc.pieChart("#gap");
        var sector_chart = dc.rowChart("#sector");
        var quarter_chart = dc.rowChart("#quarter");
        var partner_chart = dc.rowChart("#partner");
        var partnergap_chart = dc.rowChart("#partnergap");
        var gapReceived_chart = dc.barChart("#gapReceived");


        d3.csv("data/fts2014.csv", function(csv_data){
            var numberFormat = d3.format(".3s");
            var cf = crossfilter(csv_data);
			var all = cf.groupAll();
            // Implement bookmarking chart filters status --> Thanks to https://github.com/franckalbinet
            // Serializing filters values in URL
            function getFiltersValues() {
                var filters = [
                //    { name: 'gap', value: gap_chart.filters()},
                    { name: 'sector', value: sector_chart.filters()},
                    { name: 'quarter', value: quarter_chart.filters()},
                    { name: 'partner', value: partner_chart.filters()},
                    { name: 'partner', value: partnergap_chart.filters()}
                    ];

                var recursiveEncoded = $.param( filters );
                location.hash = recursiveEncoded;
            }
            // Init chart filters
            function initFilters() {
                // Get hash values
                var parseHash = /^#sector=([A-Za-z0-9,_\-\/\s]*)&status=([A-Za-z0-9,_\-\/\s]*)&org=([A-Za-z0-9,_\-\/\s]*)&map=([A-Za-z0-9,_\-\/\s]*)$/;
                var parsed = parseHash.exec(decodeURIComponent(location.hash));
                function filter(chart, rank) {  // for instance chart = sector_chart and rank in URL hash = 1
                    // sector chart
                    if (parsed[rank] == "") {
                        chart.filter(null);
                    }
                    else {
                        var filterValues = parsed[rank].split(",");
                        for (var i = 0; i < filterValues.length; i++ ) {
                            chart.filter(filterValues[i]);
                        }
                    }
                }
                if (parsed) {
                    filter(sector_chart, 1);
                    filter(quarter_chart, 2);
                    filter(partner_chart, 3);
                    filter(partnergap_chart, 4);
                //    filter(gap_chart, 5);

                }
            }

		
			
            // tooltips for row chart
            var rowTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " USD"; });

            // tooltips for pie chart
            var pieTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.data.key + "</span> : "  + numberFormat(d.value) + " USD"; });

            // tooltips for bar chart
            var barTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" + d.data.key + "</span> : " + numberFormat(d.y) + " USD";});


            cf.quarter = cf.dimension(function(d) { return d.Quarter; });
            var quarterByTotal = cf.quarter.group().reduceSum(function (d) { return d.Receive; });
            var quarter = cf.quarter.group();
            quarter_chart.width(250).height(200)
                .dimension(cf.quarter)
                .group(quarterByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                //.data(function(group) { return group.top(5); })
                .colors(['#5bc0de'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
/*				.ordering(function(d) {
					if(d.key == "0- Yearly") return 0;
					else if(d.key == "1- First Quarter") return 1;
					else if(d.key == "2- Second Quarter") return 2;
					else if(d.key == "3- Third Quarter") return 3;
					else if(d.key == "4- Fourth Quarter") return 4;
					})*/
                .xAxis().ticks(4).tickFormat(d3.format("s"));
			
				
				quarter_chart.renderlet(function(chart) {
				

				
				  chart.selectAll('rect').on("click", function(d) {
				  
				  
					if (d.key == "1- First Quarter")
					{
					quarter_chart.filterAll();
					quarter_chart.filter("1- First Quarter");
					dc.redrawAll();					
					dc.renderAll();
					}
					else if (d.key == "0- Yearly")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("0- Yearly");
					dc.redrawAll();										
					dc.renderAll();
					}					
					else if (d.key == "2- Second Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("2- Second Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}
					else if (d.key == "3- Third Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("3- Third Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}
					else if (d.key == "4- Fourth Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("4- Fourth Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}			
					
						d3.selectAll("g.row").call(rowTip);
						d3.selectAll("g.row").on('mouseover', rowTip.show).on('mouseout', rowTip.hide);
						var stackChart = 'div#gapReceived.dc-chart rect';
						d3.selectAll(stackChart).call(barTip);
						d3.selectAll(stackChart).on('mouseover', barTip.show).on('mouseout', barTip.hide);						
					
				  });
				  	chart.selectAll('text').on("click", function(d) {
					if (d.key == "0- Yearly")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("0- Yearly");
					dc.redrawAll();										
					dc.renderAll();
					}						
					else if (d.key == "1- First Quarter")
					{
					quarter_chart.filterAll();
					quarter_chart.filter("1- First Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}
					else if (d.key == "2- Second Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("2- Second Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}
					else if (d.key == "3- Third Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("3- Third Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}
					else if (d.key == "4- Fourth Quarter")
					{
					quarter_chart.filterAll();					
					quarter_chart.filter("4- Fourth Quarter");
					dc.redrawAll();										
					dc.renderAll();
					}	
						d3.selectAll("g.row").call(rowTip);
						d3.selectAll("g.row").on('mouseover', rowTip.show).on('mouseout', rowTip.hide);
						var stackChart = 'div#gapReceived.dc-chart rect';
						d3.selectAll(stackChart).call(barTip);
						d3.selectAll(stackChart).on('mouseover', barTip.show).on('mouseout', barTip.hide);                                    
					
				  });
				});				


            cf.sector = cf.dimension(function(d) { return d.Sector; });
            var sectorByTotal = cf.sector.group().reduceSum(function (d) { return d.Receive; });
            var sector = cf.sector.group();
            sector_chart.width(250).height(210)
                .dimension(cf.sector)
                .group(sectorByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) { return group.top(10); })
                .colors(['#5bc0de'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));


            cf.partner = cf.dimension(function(d) { return d.Partner; });
            var partnerByTotal = cf.partner.group().reduceSum(function (d) { return d.Receive; });
            var partner = cf.partner.group();
            partner_chart.width(250).height(500)
                .dimension(cf.partner)
                .group(partnerByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) { return group.top(20); })
                .colors(['#5bc0de'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));

            cf.partnergap = cf.dimension(function(d) { return d.Partner; });
            var partnergapByTotal = cf.partnergap.group().reduceSum(function (d) { return (d.Required - d.NewReceived); });
            var partnergap = cf.partnergap.group();
            partnergap_chart.width(250).height(500)
                .dimension(cf.partnergap)
                .group(partnergapByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) { return group.top(20); })
                .colors(['#e99002'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));


            cf.sectorGroup = cf.dimension(function(d) { return d.Sector; });
            cf.gapReceived = cf.dimension(function(d) { return d.Receive; });
            var gapByTotal = cf.sectorGroup.group().reduceSum(function (d) { return (d.Required - d.NewReceived); });
            var receiveByTotal = cf.sectorGroup.group().reduceSum(function (d) { return d.NewReceived; });
            var sectors = ["CASH","EDUCATION","FOOD SECURITY","HEALTH","NFI","PROTECTION","SHELTER","WASH"];
            var gapReceived = cf.gapReceived.group();
            var sectorGroup = cf.sectorGroup.group();
            /* when any bar is clicked, recolor the chart */
            var colorRenderlet = function (_chart) {
                _chart.selectAll("rect.bar")
                        .on("click", function (d) {
                            function setAttr(selection, keyName) {
                                selection.style("fill", function (d) {
                                    if (d[keyName] == "Received") return "#5bc0de";
                                    else if (d[keyName] == "Gap") return "#e99002";
                                });
                            };
                            setAttr(_chart.selectAll("g.stack").selectAll("rect.bar"), "layer")
                            setAttr(_chart.selectAll("g.dc-legend-item").selectAll("rect"), "name")
                        });
            };            
            gapReceived_chart.width(580).height(240)
                .margins({top: 50, right: 20, left: 75, bottom: 20})
                .dimension(sectorGroup)
                .group(receiveByTotal,"Received")
                .stack(gapByTotal,"Gap")
                .x(d3.scale.ordinal().domain(sectorGroup))
                .xUnits(dc.units.ordinal)
                .renderHorizontalGridLines(true)
                .barPadding(0.2)
                .outerPadding(0.05)
                .elasticY(true)
                .brushOn(false)
                .renderlet(colorRenderlet)
                .legend(dc.legend().x(375).y(10).itemHeight(15).gap(1));

            dc.dataCount("#count-info")
                .dimension(cf)
                .group(all);

            var byRequired = cf.dimension(function(d) { return d.Required; });
            var byRequiredGroup = byRequired.groupAll().reduceSum(function (d) { return d.Required; });
            dc.numberDisplay("#totalrequired")
                   .valueAccessor(function(d){return +d})
                    .group(byRequiredGroup);

            var byReceived = cf.dimension(function(d) { return d.Receive; });
            var byReceivedGroup = byReceived.groupAll().reduceSum(function (d) { return d.Receive; });
            dc.numberDisplay("#totalreceived")
                   .valueAccessor(function(d){return +d})
                    .group(byReceivedGroup);

            var byGap = cf.dimension(function(d) { return d.Gap; });
            var byGapGroup = byGap.groupAll().reduceSum(function (d) { return d.Required - d.NewReceived; });
            dc.numberDisplay("#totalgap")
                   .valueAccessor(function(d){return +d})
                    .group(byGapGroup);

          // var byPercentage = cf.dimension(function(d) { return d.Percentage; });
          // var byPercentageGroup = byPercentage.groupAll().reduceSum(function (d) { return d.Percentage; });
            var byPercentage = cf.dimension(function (d) { return (d.Gap / d.Required);});
            var byPercentageGroup = byPercentage.groupAll().reduceSum(function (d) { return (d.Gap / d.Required);});
            dc.numberDisplay("#totalpercentage")
                   .valueAccessor(function(d){return +d})
                    .group(byPercentageGroup);


            $('#loading').hide();
            $('#dashboard').show();
            dc.renderAll();
			
					quarter_chart.filterAll();					
					quarter_chart.filter("0- Yearly");
					dc.redrawAll();										
					dc.renderAll();
					
            /* Customised infobox */
            d3.selectAll("g.row").call(rowTip);
            d3.selectAll("g.row").on('mouseover', rowTip.show).on('mouseout', rowTip.hide);

            var stackChart = 'div#gapReceived.dc-chart rect';
            d3.selectAll(stackChart).call(barTip);
            d3.selectAll(stackChart).on('mouseover', barTip.show).on('mouseout', barTip.hide);

            }
            );

    </script>
    <script src="js/bootstrap.js"></script>

      <!-- Piwik -->
        <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://data.unhcr.org/piwik/" : "http://data.unhcr.org/piwik/");
        document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
        </script><script type="text/javascript">
        try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 14);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
        } catch( err ) {}
        </script><noscript><p><img src="http://data.unhcr.org/piwik/piwik.php?idsite=14" style="border:0" alt="" /></p></noscript>
      <!-- End Piwik Tracking Code -->


  </body>
</html>
